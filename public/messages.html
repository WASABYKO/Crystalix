<!DOCTYPE html>
<html lang="ru" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä | TechTariff</title>
    
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self';
        script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com;
        style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://fonts.googleapis.com;
        font-src 'self' data: https://fonts.gstatic.com https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/webfonts/;
        img-src 'self' data: https: http://localhost:3000;
        connect-src 'self' ws: wss: ws://localhost:3000 http://localhost:3000;
        frame-ancestors 'none';
    ">

    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/loader.css">
    <link rel="stylesheet" href="/css/messages.css">
    <link rel="stylesheet" href="/css/search-results.css">
    <link rel="stylesheet" href="/css/calls.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
        .chat-avatar {
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            font-size: 18px;
        }
        
        .user-avatar {
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 14px;
        }
        
        .right-panel-avatar {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
        }
        
        .avatar-initials {
            font-size: inherit;
            font-weight: 700;
            text-transform: uppercase;
        }

        /* –¶–≤–µ—Ç–æ–≤—ã–µ –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã –¥–ª—è –∞–≤–∞—Ç–∞—Ä–æ–≤ */
        .avatar-gradient-1 { background: linear-gradient(135deg, #6366f1, #8b5cf6); }
        .avatar-gradient-2 { background: linear-gradient(135deg, #10b981, #059669); }
        .avatar-gradient-3 { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .avatar-gradient-4 { background: linear-gradient(135deg, #ef4444, #dc2626); }
        .avatar-gradient-5 { background: linear-gradient(135deg, #ec4899, #be185d); }
        .avatar-gradient-6 { background: linear-gradient(135deg, #06b6d4, #0891b2); }
        .avatar-gradient-7 { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
        .avatar-gradient-8 { background: linear-gradient(135deg, #14b8a6, #0d9488); }
    </style>
</head>
<body>
    <!-- Skip link –¥–ª—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ -->
    <a href="#mainContent" class="skip-link">–ü–µ—Ä–µ–π—Ç–∏ –∫ –æ—Å–Ω–æ–≤–Ω–æ–º—É –∫–æ–Ω—Ç–µ–Ω—Ç—É</a>

    <!-- –§–æ–Ω –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞ -->
    <div class="messenger-bg">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
        <div class="orb orb-3"></div>
    </div>
    
    <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã -->
    <div class="theme-toggle">
        <button class="btn-icon" id="themeToggle" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É" title="–°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É">
            <i class="fas fa-moon"></i>
        </button>
    </div>
    
    <!-- –õ–æ–∞–¥–µ—Ä -->
    <div id="globalLoader" class="loader-container">
        <div class="particles" id="particles"></div>
        <div class="loader-overlay"></div>
        <div class="loader-text">
            <div class="loader-dots">
                <span class="dot"></span>
                <span class="dot"></span>
                <span class="dot"></span>
            </div>
            <p>–ó–∞–≥—Ä—É–∑–∫–∞ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞</p>
            <p id="loaderMessage">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...</p>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
    <main class="messages-container" id="mainContent" role="main" aria-label="–û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞">
        <!-- –õ–µ–≤—ã–π —Å–∞–π–¥–±–∞—Ä - –°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ –∏ –¥—Ä—É–∑–µ–π -->
        <aside class="messages-sidebar" id="messagesSidebar" role="complementary" aria-label="–°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤">
            <button class="sidebar-close-btn" id="sidebarCloseBtn" aria-label="–ó–∞–∫—Ä—ã—Ç—å –º–µ–Ω—é" style="display: none;">
                <i class="fas fa-times"></i>
            </button>
            <div class="sidebar-header">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                    <h2 style="margin: 0;"><i class="fas fa-comment-dots"></i> –ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä</h2>
                </div>
                <div class="sidebar-actions">
                    <button id="newChatBtn" class="btn btn-primary btn-sm" aria-label="–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —á–∞—Ç">
                        <i class="fas fa-plus"></i> –ù–æ–≤—ã–π —á–∞—Ç
                    </button>
                    <button id="searchUsersBtn" class="btn-icon" title="–ü–æ–∏—Å–∫" aria-label="–ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
            </div>

            <div class="search-container">
                <input type="text" id="chatSearch" placeholder="–ü–æ–∏—Å–∫ —á–∞—Ç–æ–≤..." class="search-input" 
                       aria-label="–ü–æ–∏—Å–∫ —á–∞—Ç–æ–≤">
            </div>

            <nav class="sidebar-tabs" role="tablist" aria-label="–†–∞–∑–¥–µ–ª—ã –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞">
                <button class="tab-btn active" data-tab="chats" role="tab" aria-selected="true" aria-controls="chatsTab">
                    <i class="fas fa-comments"></i> –ß–∞—Ç—ã
                </button>
                <button class="tab-btn" data-tab="friends" role="tab" aria-selected="false" aria-controls="friendsTab">
                    <i class="fas fa-user-friends"></i> –î—Ä—É–∑—å—è
                </button>
                <button class="tab-btn" data-tab="requests" role="tab" aria-selected="false" aria-controls="requestsTab">
                    <i class="fas fa-user-plus"></i> –ó–∞—è–≤–∫–∏
                    <span class="chat-badge" id="requestsBadge">2</span>
                </button>
            </nav>

            <!-- –í–∫–ª–∞–¥–∫–∞ –ß–∞—Ç—ã -->
            <div class="tab-content active" id="chatsTab" role="tabpanel" aria-labelledby="chats-tab">
                <div class="chats-list" id="chatsList" role="list" aria-label="–°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤">
                    <!-- –ß–∞—Ç—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                </div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ –î—Ä—É–∑—å—è -->
            <div class="tab-content" id="friendsTab" role="tabpanel" aria-labelledby="friends-tab">
                <div class="friends-list" id="friendsList" role="list" aria-label="–°–ø–∏—Å–æ–∫ –¥—Ä—É–∑–µ–π">
                    <!-- –î—Ä—É–∑—å—è –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                </div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ –ó–∞—è–≤–∫–∏ -->
            <div class="tab-content" id="requestsTab" role="tabpanel" aria-labelledby="requests-tab">
                <div class="requests-tabs">
                    <button class="sub-tab-btn active" data-subtab="incoming" aria-pressed="true">
                        <i class="fas fa-arrow-down"></i> –í—Ö–æ–¥—è—â–∏–µ
                        <span class="requests-count-badge" id="incomingRequestsCount" style="display: none;">0</span>
                    </button>
                    <button class="sub-tab-btn" data-subtab="outgoing" aria-pressed="false">
                        <i class="fas fa-arrow-up"></i> –ò—Å—Ö–æ–¥—è—â–∏–µ
                    </button>
                </div>
                <!-- –§–∏–ª—å—Ç—Ä—ã –∑–∞—è–≤–æ–∫ -->
                <div class="requests-filters">
                    <button class="filter-btn active" data-filter="all">–í—Å–µ</button>
                    <button class="filter-btn" data-filter="new">–ù–æ–≤—ã–µ</button>
                    <button class="filter-btn" data-filter="accepted">–ü—Ä–∏–Ω—è—Ç—ã–µ</button>
                    <button class="filter-btn" data-filter="rejected">–û—Ç–∫–ª–æ–Ω—ë–Ω–Ω—ã–µ</button>
                </div>
                <!-- Pull-to-refresh –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä -->
                <div class="pull-to-refresh" id="pullToRefresh">
                    <i class="fas fa-spinner fa-spin"></i> –ó–∞–≥—Ä—É–∑–∫–∞...
                </div>
                <div class="requests-list" id="requestsList" role="list" aria-label="–ó–∞—è–≤–∫–∏ –≤ –¥—Ä—É–∑—å—è">
                    <!-- –ó–∞—è–≤–∫–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                </div>
                <!-- –°—á—ë—Ç—á–∏–∫ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö -->
                <div class="unread-badge-container" id="unreadBadgeContainer" style="display: none;">
                    <span class="unread-badge" id="unreadRequestsBadge">0</span>
                    <span>–Ω–æ–≤—ã—Ö –∑–∞—è–≤–æ–∫</span>
                </div>
            </div>
        </aside>

        <!-- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –æ–±–ª–∞—Å—Ç—å - –ß–∞—Ç -->
        <section class="messages-main" aria-label="–û–±–ª–∞—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–π">
            <!-- Header —á–∞—Ç–∞ -->
            <header class="chat-header" id="chatHeader">
                <div class="chat-info">
                    <button class="btn-icon mobile-menu-btn" id="mobileMenuBtn" aria-label="–û—Ç–∫—Ä—ã—Ç—å –º–µ–Ω—é" style="display: none;">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="chat-avatar" id="chatAvatar">
                        <span class="avatar-initials">?</span>
                    </div>
                    <div class="chat-details">
                        <h3 id="chatTitle">–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç</h3>
                        <p class="chat-status" id="chatStatus">
                            <span class="dot" id="connectionDot"></span>
                            <span id="connectionStatus">–û–∂–∏–¥–∞–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è...</span>
                        </p>
                    </div>
                </div>
                <div class="chat-actions">
                    <button class="btn-icon" id="videoCallBtn" title="–í–∏–¥–µ–æ–∑–≤–æ–Ω–æ–∫" aria-label="–ù–∞—á–∞—Ç—å –≤–∏–¥–µ–æ–∑–≤–æ–Ω–æ–∫" disabled>
                        <i class="fas fa-video"></i>
                    </button>
                    <button class="btn-icon" id="voiceCallBtn" title="–ì–æ–ª–æ—Å–æ–≤–æ–π –∑–≤–æ–Ω–æ–∫" aria-label="–ü–æ–∑–≤–æ–Ω–∏—Ç—å" disabled>
                        <i class="fas fa-phone"></i>
                    </button>
                    <button class="btn-icon" id="chatInfoBtn" title="–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è" aria-label="–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —á–∞—Ç–µ" disabled>
                        <i class="fas fa-info-circle"></i>
                    </button>
                    <button class="btn-icon" id="chatSettingsBtn" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏" aria-label="–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —á–∞—Ç–∞">
                        <i class="fas fa-ellipsis-v"></i>
                    </button>
                </div>
            </header>

            <!-- –û–±–ª–∞—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–π -->
            <div class="messages-area" id="messagesArea" role="log" aria-label="–ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π" aria-live="polite">
                <!-- –ü—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ -->
                <div class="empty-state" id="emptyState">
                    <i class="fas fa-comments"></i>
                    <h3>–í–∞—à–∏ —á–∞—Ç—ã</h3>
                    <p>–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç –∏–∑ —Å–ø–∏—Å–∫–∞ —Å–ª–µ–≤–∞ –∏–ª–∏ –Ω–∞—á–Ω–∏—Ç–µ –Ω–æ–≤—ã–π –¥–∏–∞–ª–æ–≥</p>
                    <div style="margin-top: 20px; display: flex; gap: 12px; justify-content: center; flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="document.getElementById('newChatBtn').click()">
                            <i class="fas fa-plus"></i> –ù–æ–≤—ã–π —á–∞—Ç
                        </button>
                        <a href="/dashboard.html" class="btn btn-outline">
                            <i class="fas fa-arrow-left"></i> –í –∫–∞–±–∏–Ω–µ—Ç
                        </a>
                    </div>
                </div>
                <!-- –°–ø–∏—Å–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π -->
                <div class="messages-list" id="messagesList" style="display: none;" role="list" aria-label="–°–æ–æ–±—â–µ–Ω–∏—è">
                    <!-- –°–æ–æ–±—â–µ–Ω–∏—è –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                </div>
            </div>

            <!-- –û–±–ª–∞—Å—Ç—å –≤–≤–æ–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏—è -->
            <div class="message-input-area" id="dropZone">
                <div class="input-actions">
                    <button class="btn-icon" id="emojiBtn" title="–°–º–∞–π–ª–∏–∫–∏" aria-label="–î–æ–±–∞–≤–∏—Ç—å —Å–º–∞–π–ª–∏–∫">
                        <i class="far fa-smile"></i>
                    </button>
                    <button class="btn-icon" id="attachBtn" title="–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å" aria-label="–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–∞–π–ª">
                        <i class="fas fa-paperclip"></i>
                    </button>
                    <button class="btn-icon" id="voiceBtn" title="–ì–æ–ª–æ—Å–æ–≤–æ–µ" aria-label="–ó–∞–ø–∏—Å–∞—Ç—å –≥–æ–ª–æ—Å–æ–≤–æ–µ">
                        <i class="fas fa-microphone"></i>
                    </button>
                </div>
                <div class="message-input-wrapper">
                    <input type="text" 
                           id="messageInput" 
                           placeholder="–ù–∞–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ..." 
                           autocomplete="off"
                           aria-label="–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è"
                           aria-describedby="messageInputHint"
                           disabled>
                    <div id="messageInputHint" class="sr-only">–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –∏ –Ω–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏</div>
                </div>
                <button class="btn btn-primary" id="sendMessageBtn" aria-label="–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ" disabled>
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>

            <!-- Drag and drop overlay -->
            <div class="drop-overlay" id="dropOverlay" style="display: none;">
                <div class="drop-content">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <h3>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª—ã —Å—é–¥–∞</h3>
                    <p>–∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</p>
                </div>
            </div>
        </section>

        <!-- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —á–∞—Ç–µ (—Å–∫—Ä—ã—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
        <aside class="messages-right-panel" id="rightPanel" role="complementary" aria-label="–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —á–∞—Ç–µ" style="display: none;">
            <div class="right-panel-header">
                <div class="right-panel-avatar" id="rightPanelAvatar">
                    <span class="avatar-initials">?</span>
                </div>
                <h3 class="right-panel-title" id="rightPanelTitle">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                <p class="right-panel-status" id="rightPanelStatus">
                    <span class="dot"></span>
                    –û—Ñ–ª–∞–π–Ω
                </p>
            </div>
            
            <div class="right-panel-section">
                <h4><i class="fas fa-info-circle"></i> –û —á–∞—Ç–µ</h4>
                <div class="right-panel-item">
                    <i class="fas fa-calendar-alt"></i>
                    <div class="item-content">
                        <span class="item-label">–°–æ–∑–¥–∞–Ω</span>
                        <span class="item-value" id="chatCreated">-</span>
                    </div>
                </div>
                <div class="right-panel-item">
                    <i class="fas fa-comment-alt"></i>
                    <div class="item-content">
                        <span class="item-label">–°–æ–æ–±—â–µ–Ω–∏–π</span>
                        <span class="item-value" id="chatMessagesCount">0</span>
                    </div>
                </div>
                <div class="right-panel-item">
                    <i class="fas fa-bell"></i>
                    <div class="item-content">
                        <span class="item-label">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</span>
                        <span class="item-value" id="chatNotifications">–í–∫–ª—é—á–µ–Ω—ã</span>
                    </div>
                </div>
            </div>
            
            <div class="right-panel-section">
                <h4><i class="fas fa-users"></i> –£—á–∞—Å—Ç–Ω–∏–∫–∏ <span class="badge badge-primary" id="memberCount">1</span></h4>
                <div id="chatMembers">
                    <!-- –£—á–∞—Å—Ç–Ω–∏–∫–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                </div>
            </div>

            <div class="right-panel-section">
                <h4><i class="fas fa-image"></i> –ú–µ–¥–∏–∞</h4>
                <div class="media-grid" id="mediaGrid" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px;">
                    <!-- –ú–µ–¥–∏–∞ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                </div>
                <button class="btn btn-outline btn-block" style="margin-top: 12px;" id="viewAllMediaBtn">
                    <i class="fas fa-images"></i> –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ
                </button>
            </div>

            <div class="right-panel-section">
                <h4><i class="fas fa-cog"></i> –î–µ–π—Å—Ç–≤–∏—è</h4>
                <button class="btn btn-outline btn-block" style="margin-bottom: 8px;" id="searchInChatBtn">
                    <i class="fas fa-search"></i> –ü–æ–∏—Å–∫ –≤ —á–∞—Ç–µ
                </button>
                <button class="btn btn-outline btn-block" style="margin-bottom: 8px;" id="pinChatBtn">
                    <i class="fas fa-thumbtack"></i> –ó–∞–∫—Ä–µ–ø–∏—Ç—å —á–∞—Ç
                </button>
                <button class="btn btn-outline btn-block" style="margin-bottom: 8px;" id="muteChatBtn">
                    <i class="fas fa-bell-slash"></i> –ë–µ–∑ –∑–≤—É–∫–∞
                </button>
                <button class="btn btn-danger btn-block" id="clearChatBtn">
                    <i class="fas fa-trash"></i> –û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é
                </button>
            </div>
        </aside>
    </main>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤–∏–¥–µ–æ–∑–≤–æ–Ω–∫–∞ -->
    <div id="videoCallModal" class="modal">
        <div class="modal-content" style="max-width: 100%; max-height: 100%; background: #000; border: none; border-radius: 0;">
            <div class="video-call-overlay">
                <div class="video-call-main">
                    <!-- –£–¥–∞–ª—ë–Ω–Ω–æ–µ –≤–∏–¥–µ–æ –∏–ª–∏ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä -->
                    <div class="remote-video-container">
                        <video id="remoteVideo" autoplay playsinline></video>
                        <div class="no-video-placeholder" id="noVideoPlaceholder">
                            <div class="avatar" id="videoCallAvatar">
                                <span class="avatar-initials">?</span>
                            </div>
                            <h3 id="videoCallName">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</h3>
                            <p id="videoCallStatus">–û–∂–∏–¥–∞–Ω–∏–µ...</p>
                        </div>
                    </div>
                    <!-- –°–≤–æ—ë –≤–∏–¥–µ–æ (PIP) -->
                    <div class="local-video-container">
                        <video id="localVideo" autoplay playsinline muted></video>
                    </div>
                    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–≤–æ–Ω–∫–µ -->
                    <div class="video-call-info">
                        <div class="video-call-duration" id="callDuration">00:00</div>
                        <div class="video-call-quality">
                            <span class="quality-indicator" id="qualityIndicator"></span>
                            <span id="qualityText">HD –∫–∞—á–µ—Å—Ç–≤–æ</span>
                        </div>
                    </div>
                </div>
                <!-- –≠–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–≤–æ–Ω–∫–æ–º -->
                <div class="video-call-controls">
                    <!-- –í—ã–±–æ—Ä –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ -->
                    <div class="mic-selector-container">
                        <button class="video-call-btn mic-device-btn" id="micDeviceBtn" aria-label="–í—ã–±—Ä–∞—Ç—å –º–∏–∫—Ä–æ—Ñ–æ–Ω" title="–í—ã–±—Ä–∞—Ç—å –º–∏–∫—Ä–æ—Ñ–æ–Ω">
                            <i class="fas fa-microphone"></i>
                            <span class="mic-indicator"></span>
                        </button>
                        <div class="mic-device-dropdown" id="micDeviceDropdown" style="display: none;">
                            <div class="dropdown-header">
                                <i class="fas fa-microphone"></i>
                                –í—ã–±–µ—Ä–∏—Ç–µ –º–∏–∫—Ä–æ—Ñ–æ–Ω
                            </div>
                            <div class="mic-device-list" id="micDeviceList">
                                <!-- –°–ø–∏—Å–æ–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è JS -->
                            </div>
                        </div>
                    </div>
                    <button class="video-call-btn" id="toggleMicBtn" aria-label="–í—ã–∫–ª—é—á–∏—Ç—å –º–∏–∫—Ä–æ—Ñ–æ–Ω" title="–ú–∏–∫—Ä–æ—Ñ–æ–Ω">
                        <i class="fas fa-microphone"></i>
                    </button>
                    <button class="video-call-btn" id="toggleCameraBtn" aria-label="–í—ã–∫–ª—é—á–∏—Ç—å –∫–∞–º–µ—Ä—É" title="–ö–∞–º–µ—Ä–∞">
                        <i class="fas fa-video"></i>
                    </button>
                    <button class="video-call-btn switch-camera" id="switchCameraBtn" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –∫–∞–º–µ—Ä—É" title="–°–º–µ–Ω–∏—Ç—å –∫–∞–º–µ—Ä—É">
                        <i class="fas fa-camera-rotate"></i>
                    </button>
                    <button class="video-call-btn reset-call" id="resetCallBtn" aria-label="–ù–∞—á–∞—Ç—å –∑–≤–æ–Ω–æ–∫ –∑–∞–Ω–æ–≤–æ" title="–ù–∞—á–∞—Ç—å –∑–≤–æ–Ω–æ–∫ –∑–∞–Ω–æ–≤–æ">
                        <i class="fas fa-redo"></i>
                    </button>
                    <button class="video-call-btn end-call" id="endCallBtn" aria-label="–ó–∞–≤–µ—Ä—à–∏—Ç—å –∑–≤–æ–Ω–æ–∫" title="–ó–∞–≤–µ—Ä—à–∏—Ç—å">
                        <i class="fas fa-phone-slash"></i>
                    </button>
                    <button class="video-call-btn fullscreen-btn" id="fullscreenBtn" aria-label="–ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º" title="–ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω">
                        <i class="fas fa-expand"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
    <div id="searchUsersModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-search"></i> –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>
                <button class="modal-close" aria-label="–ó–∞–∫—Ä—ã—Ç—å">&times;</button>
            </div>
            <div class="modal-body">
                <div class="search-box">
                    <input type="text" 
                           id="userSearchInput" 
                           placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è, email –∏–ª–∏ ID..." 
                           autocomplete="off"
                           aria-label="–ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π">
                    <button id="searchBtn" class="btn btn-primary" aria-label="–ò—Å–∫–∞—Ç—å">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
                <div class="search-results" id="searchResults" role="list" aria-label="–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞">
                    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–æ–≤–æ–≥–æ —á–∞—Ç–∞ -->
    <div id="newChatModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-plus-circle"></i> –ù–æ–≤—ã–π —á–∞—Ç</h3>
                <button class="modal-close" aria-label="–ó–∞–∫—Ä—ã—Ç—å">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label><i class="fas fa-user-friends"></i> –°–æ–∑–¥–∞—Ç—å –¥–∏–∞–ª–æ–≥</label>
                    <select id="friendSelect" class="form-control">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –¥—Ä—É–≥–∞...</option>
                        <!-- –û–ø—Ü–∏–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                    </select>
                </div>
                <button id="startChatBtn" class="btn btn-primary btn-block">
                    <i class="fas fa-comment-medical"></i> –ù–∞—á–∞—Ç—å –¥–∏–∞–ª–æ–≥
                </button>
                <div class="divider"><span>–∏–ª–∏</span></div>
                <div class="form-group">
                    <label><i class="fas fa-users"></i> –°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É</label>
                    <input type="text" 
                           id="groupName" 
                           placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã" 
                           class="form-control">
                </div>
                <div class="form-group">
                    <label><i class="fas fa-users-cog"></i> –£—á–∞—Å—Ç–Ω–∏–∫–∏</label>
                    <div class="group-participants" id="groupParticipants" style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px;">
                        <!-- –£—á–∞—Å—Ç–Ω–∏–∫–∏ –≥—Ä—É–ø–ø—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                    </div>
                </div>
                <button id="createGroupBtn" class="btn btn-outline btn-block" disabled>
                    <i class="fas fa-users-cog"></i> –°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É
                </button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–≤–∞—Ç–∞—Ä–∫–∏ -->
    <div id="avatarUploadModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-camera"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å –∞–≤–∞—Ç–∞—Ä–∫—É</h3>
                <button class="modal-close" aria-label="–ó–∞–∫—Ä—ã—Ç—å">&times;</button>
            </div>
            <div class="modal-body">
                <div class="avatar-upload-area" id="avatarDropZone" role="button" tabindex="0" aria-label="–ó–∞–≥—Ä—É–∑–∏—Ç—å –∞–≤–∞—Ç–∞—Ä–∫—É">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <p>–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</p>
                    <button class="btn btn-outline" onclick="document.getElementById('avatarFileInput').click()">
                        <i class="fas fa-folder-open"></i> –í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª
                    </button>
                    <input type="file" id="avatarFileInput" accept="image/jpeg,image/png,image/gif" style="display: none;" aria-label="–í—ã–±–æ—Ä —Ñ–∞–π–ª–∞">
                </div>
                <div class="avatar-preview" id="avatarPreview" style="display: none;">
                    <img id="avatarPreviewImg" src="" alt="–ü—Ä–µ–≤—å—é –∞–≤–∞—Ç–∞—Ä–∫–∏">
                    <button class="btn btn-primary" id="confirmUploadBtn">
                        <i class="fas fa-upload"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å
                    </button>
                </div>
                <p class="text-muted text-center">
                    <small>–†–∞–∑—Ä–µ—à–µ–Ω—ã: JPEG, PNG, GIF. –ú–∞–∫—Å. —Ä–∞–∑–º–µ—Ä: 5MB</small>
                </p>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø—Ä–æ—Ñ–∏–ª—è -->
    <div id="profileSettingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-user-cog"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è</h3>
                <button class="modal-close" aria-label="–ó–∞–∫—Ä—ã—Ç—å">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group text-center">
                    <div class="chat-avatar" id="profileAvatar" style="width: 80px; height: 80px; margin: 0 auto 16px; font-size: 28px;">
                        <span class="avatar-initials">–¢–ü</span>
                    </div>
                    <button class="btn btn-outline btn-sm" onclick="document.getElementById('avatarUploadModal').querySelector('.modal-close').click(); document.getElementById('avatarUploadModal').classList.add('active');">
                        <i class="fas fa-camera"></i> –ò–∑–º–µ–Ω–∏—Ç—å —Ñ–æ—Ç–æ
                    </button>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-user"></i> –ò–º—è</label>
                    <input type="text" id="profileName" class="form-control" placeholder="–í–∞—à–µ –∏–º—è">
                </div>
                <div class="form-group">
                    <label><i class="fas fa-envelope"></i> Email</label>
                    <input type="email" id="profileEmail" class="form-control" placeholder="–í–∞—à email" disabled>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-info-circle"></i> –û —Å–µ–±–µ</label>
                    <textarea id="profileBio" class="form-control" rows="3" placeholder="–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ —Å–µ–±–µ..."></textarea>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-toggle-on"></i> –°—Ç–∞—Ç—É—Å</label>
                    <select id="profileStatus" class="form-control">
                        <option value="online">üü¢ –û–Ω–ª–∞–π–Ω</option>
                        <option value="away">üü° –ù–µ –±–µ—Å–ø–æ–∫–æ–∏—Ç—å</option>
                        <option value="dnd">üî¥ –ù–µ –±–µ—Å–ø–æ–∫–æ–∏—Ç—å</option>
                        <option value="offline">‚ö™ –û—Ñ–ª–∞–π–Ω</option>
                    </select>
                </div>
                <button id="saveProfileBtn" class="btn btn-primary btn-block">
                    <i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                </button>
            </div>
        </div>
    </div>

    <!-- =============== PREMIUM ELEMENTS =============== -->
    
    <!-- Emoji Picker -->
    <div class="emoji-picker" id="emojiPicker">
        <div class="emoji-grid">
            <span class="emoji-item">üòÄ</span>
            <span class="emoji-item">üòÇ</span>
            <span class="emoji-item">ü•∞</span>
            <span class="emoji-item">üòç</span>
            <span class="emoji-item">ü§î</span>
            <span class="emoji-item">üòé</span>
            <span class="emoji-item">ü•∫</span>
            <span class="emoji-item">üò≠</span>
            <span class="emoji-item">üò°</span>
            <span class="emoji-item">üëç</span>
            <span class="emoji-item">üëé</span>
            <span class="emoji-item">‚ù§Ô∏è</span>
            <span class="emoji-item">üíî</span>
            <span class="emoji-item">üéâ</span>
            <span class="emoji-item">üî•</span>
            <span class="emoji-item">‚ú®</span>
            <span class="emoji-item">üíØ</span>
            <span class="emoji-item">üôè</span>
            <span class="emoji-item">üí™</span>
            <span class="emoji-item">üëÄ</span>
            <span class="emoji-item">üéÆ</span>
            <span class="emoji-item">üçï</span>
            <span class="emoji-item">üöÄ</span>
            <span class="emoji-item">üåü</span>
            <span class="emoji-item">üíé</span>
            <span class="emoji-item">üéÅ</span>
            <span class="emoji-item">‚úÖ</span>
            <span class="emoji-item">‚ùå</span>
            <span class="emoji-item">‚ùì</span>
            <span class="emoji-item">üí¨</span>
            <span class="emoji-item">üìû</span>
            <span class="emoji-item">üì∑</span>
            <span class="emoji-item">üéµ</span>
            <span class="emoji-item">üìç</span>
        </div>
    </div>
    
    <!-- Attach Menu -->
    <div class="attach-menu" id="attachMenu">
        <div class="attach-menu-item" data-type="photo">
            <i class="fas fa-image"></i>
            <span>–§–æ—Ç–æ / –í–∏–¥–µ–æ</span>
        </div>
        <div class="attach-menu-item" data-type="file">
            <i class="fas fa-file"></i>
            <span>–§–∞–π–ª</span>
        </div>
        <div class="attach-menu-item" data-type="contact">
            <i class="fas fa-address-book"></i>
            <span>–ö–æ–Ω—Ç–∞–∫—Ç</span>
        </div>
        <div class="attach-menu-item" data-type="location">
            <i class="fas fa-map-marker-alt"></i>
            <span>–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</span>
        </div>
    </div>
    
    <!-- Chat Settings Dropdown -->
    <div class="dropdown-menu" id="chatSettingsDropdown">
        <div class="dropdown-item" data-action="rename">
            <i class="fas fa-pen"></i>
            <span>–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å —á–∞—Ç</span>
        </div>
        <div class="dropdown-item" data-action="add-member">
            <i class="fas fa-user-plus"></i>
            <span>–î–æ–±–∞–≤–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞</span>
        </div>
        <div class="dropdown-item" data-action="export">
            <i class="fas fa-file-export"></i>
            <span>–≠–∫—Å–ø–æ—Ä—Ç –∏—Å—Ç–æ—Ä–∏–∏</span>
        </div>
        <div class="dropdown-divider"></div>
        <div class="dropdown-item danger" data-action="leave">
            <i class="fas fa-sign-out-alt"></i>
            <span>–ü–æ–∫–∏–Ω—É—Ç—å —á–∞—Ç</span>
        </div>
    </div>
    
    <!-- Message Context Menu -->
    <div class="message-context-menu" id="messageContextMenu">
        <div class="context-menu-item" data-action="reply">
            <i class="fas fa-reply"></i>
            <span>–û—Ç–≤–µ—Ç–∏—Ç—å</span>
        </div>
        <div class="context-menu-item" data-action="forward">
            <i class="fas fa-share"></i>
            <span>–ü–µ—Ä–µ—Å–ª–∞—Ç—å</span>
        </div>
        <div class="context-menu-item" data-action="copy">
            <i class="fas fa-copy"></i>
            <span>–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</span>
        </div>
        <div class="context-menu-divider"></div>
        <div class="context-menu-item" data-action="delete">
            <i class="fas fa-trash"></i>
            <span>–£–¥–∞–ª–∏—Ç—å</span>
        </div>
    </div>
    
    <!-- Reactions Bubble -->
    <div class="reactions-bubble" id="reactionsBubble">
        <span class="reaction-emoji" data-reaction="üëç">üëç</span>
        <span class="reaction-emoji" data-reaction="‚ù§Ô∏è">‚ù§Ô∏è</span>
        <span class="reaction-emoji" data-reaction="üòÇ">üòÇ</span>
        <span class="reaction-emoji" data-reaction="üòÆ">üòÆ</span>
        <span class="reaction-emoji" data-reaction="üò¢">üò¢</span>
        <span class="reaction-emoji" data-reaction="üôè">üôè</span>
    </div>
    
    <!-- Voice Recording Overlay -->
    <div class="voice-recording-overlay" id="voiceRecordingOverlay">
        <div class="voice-recording-card">
            <i class="fas fa-microphone" style="font-size: 32px; color: var(--danger);"></i>
            <div class="voice-waveform" id="voiceWaveform">
                <span></span>
                <span></span>
                <span></span>
                <span></span>
                <span></span>
                <span></span>
                <span></span>
            </div>
            <div class="voice-timer" id="voiceTimer">00:00</div>
            <div class="voice-actions">
                <button class="voice-action-btn cancel" id="voiceCancelBtn" title="–û—Ç–º–µ–Ω–∞">
                    <i class="fas fa-times"></i>
                </button>
                <button class="voice-action-btn send" id="voiceSendBtn" title="–û—Ç–ø—Ä–∞–≤–∏—Ç—å">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Media Gallery Modal -->
    <div id="mediaGalleryModal" class="modal media-gallery-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-images"></i> –ú–µ–¥–∏–∞—Ñ–∞–π–ª—ã</h3>
                <button class="modal-close" aria-label="–ó–∞–∫—Ä—ã—Ç—å">&times;</button>
            </div>
            <div class="modal-body">
                <div class="media-gallery-grid" id="mediaGalleryGrid" role="list">
                    <!-- –ú–µ–¥–∏–∞ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Confirm Clear Chat Modal -->
    <div id="confirmClearChatModal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3><i class="fas fa-exclamation-triangle" style="color: var(--danger);"></i> –û—á–∏—Å—Ç–∫–∞ —á–∞—Ç–∞</h3>
                <button class="modal-close" aria-label="–ó–∞–∫—Ä—ã—Ç—å">&times;</button>
            </div>
            <div class="modal-body">
                <p style="text-align: center; margin-bottom: 24px;">
                    –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Å–æ–æ–±—â–µ–Ω–∏–π? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.
                </p>
                <div style="display: flex; gap: 12px; justify-content: center;">
                    <button class="btn btn-outline" id="cancelClearChatBtn">
                        <i class="fas fa-times"></i> –û—Ç–º–µ–Ω–∞
                    </button>
                    <button class="btn btn-danger" id="confirmClearChatBtn">
                        <i class="fas fa-trash"></i> –û—á–∏—Å—Ç–∏—Ç—å
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Toast Container -->
    <div id="toastContainer" style="position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%); z-index: 10000; display: flex; flex-direction: column; gap: 12px; pointer-events: none;"></div>
    
    <!-- Search In Chat Bar -->
    <div class="chat-header-search" id="chatHeaderSearch">
        <i class="fas fa-search" style="color: var(--text-muted);"></i>
        <input type="text" id="chatSearchInput" placeholder="–ü–æ–∏—Å–∫ –≤ —á–∞—Ç–µ..." aria-label="–ü–æ–∏—Å–∫ –≤ —á–∞—Ç–µ">
        <button class="btn-icon" id="closeChatSearchBtn" style="width: 28px; height: 28px;" aria-label="–ó–∞–∫—Ä—ã—Ç—å –ø–æ–∏—Å–∫">
            <i class="fas fa-times" style="font-size: 12px;"></i>
        </button>
    </div>
    
    <!-- Mute Duration Tooltip -->
    <div class="mute-tooltip" id="muteTooltip" style="position: absolute; background: var(--glass); backdrop-filter: blur(20px); border: 1px solid var(--glass-border); border-radius: var(--radius-sm); padding: 8px 12px; font-size: 12px; display: none; z-index: 1000;">
        <div class="mute-option" data-duration="1h" style="padding: 6px 8px; cursor: pointer;">–ù–∞ 1 —á–∞—Å</div>
        <div class="mute-option" data-duration="8h" style="padding: 6px 8px; cursor: pointer;">–ù–∞ 8 —á–∞—Å–æ–≤</div>
        <div class="mute-option" data-duration="24h" style="padding: 6px 8px; cursor: pointer;">–ù–∞ 24 —á–∞—Å–∞</div>
        <div class="mute-option" data-duration="forever" style="padding: 6px 8px; cursor: pointer;">–ù–∞–≤—Å–µ–≥–¥–∞</div>
    </div>
    
    <!-- Skeleton Loading Template -->
    <template id="skeletonTemplate">
        <div class="chat-item" style="pointer-events: none;">
            <div class="skeleton skeleton-avatar"></div>
            <div class="chat-info" style="flex: 1;">
                <div class="skeleton skeleton-text"></div>
                <div class="skeleton skeleton-text short"></div>
            </div>
        </div>
    </template>
    
    <!-- –°–∫—Ä–∏–ø—Ç—ã -->
    <script src="/js/managers/TokenManager.js"></script>
    <script src="/js/managers/AuthManager.js"></script>
    <script src="/js/managers/ConnectionManager.js"></script>
    <script src="/js/managers/RetryManager.js"></script>
    <script src="/js/managers/SafeInitializer.js"></script>
    <script src="/js/managers/WebSocketManager.js"></script>
    <script src="/js/managers/CallManager.js"></script>
    <script src="/js/managers/MediaDeviceManager.js"></script>
    
    <script src="/js/hashStorage.js"></script>
    <script src="/js/app.js"></script>

    <script src="/js/components/loader.js"></script>
    <script src="/js/components/header.js"></script>
    <script src="/js/components/footer.js"></script>
    <script src="/js/messages.js"></script>
    
    <!-- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞ -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM –∑–∞–≥—Ä—É–∂–µ–Ω, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä...');
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º UIManager –µ—Å–ª–∏ –æ–Ω —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
            if (typeof UIManager !== 'undefined') {
                window.messengerApp = { ui: new UIManager() };
                console.log('UIManager –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
            } else {
                console.error('UIManager –Ω–µ –Ω–∞–π–¥–µ–Ω! messages.js –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
            }
        });
    </script>
    <script src="/js/components/call-notification.js"></script>
    <script src="/js/components/call-status-bar.js"></script>
    <script src="/js/components/call-history.js"></script>
    
    <!-- –ü—Ä–∏–≤—è–∑–∫–∞ —Å–æ–±—ã—Ç–∏–π –∫–Ω–æ–ø–æ–∫ –∑–≤–æ–Ω–∫–æ–≤ -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º wsManager –¥–ª—è CallManager
            if (typeof WebSocketManager !== 'undefined') {
                window.wsManager = WebSocketManager;
            }
            
            // –í–∏–¥–µ–æ–∑–≤–æ–Ω–æ–∫
            const videoCallBtn = document.getElementById('videoCallBtn');
            if (videoCallBtn) {
                videoCallBtn.addEventListener('click', function() {
                    if (window.messengerApp && window.messengerApp.ui && window.messengerApp.ui.activeChatId) {
                        const friendId = window.messengerApp.ui.chats.find(c => c.id === window.messengerApp.ui.activeChatId)?.participantId;
                        if (friendId && typeof window.CallManager !== 'undefined') {
                            window.CallManager.startCall(friendId, true);
                        }
                    }
                });
            }
            
            // –ì–æ–ª–æ—Å–æ–≤–æ–π –∑–≤–æ–Ω–æ–∫
            const voiceCallBtn = document.getElementById('voiceCallBtn');
            if (voiceCallBtn) {
                voiceCallBtn.addEventListener('click', function() {
                    if (window.messengerApp && window.messengerApp.ui && window.messengerApp.ui.activeChatId) {
                        const friendId = window.messengerApp.ui.chats.find(c => c.id === window.messengerApp.ui.activeChatId)?.participantId;
                        if (friendId && typeof window.CallManager !== 'undefined') {
                            window.CallManager.startCall(friendId, false);
                        }
                    }
                });
            }
            
            // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–≤–æ–Ω–∫–æ–º
            const endCallBtn = document.getElementById('endCallBtn');
            if (endCallBtn && typeof window.CallManager !== 'undefined') {
                endCallBtn.addEventListener('click', function() {
                    window.CallManager.endCall();
                });
            }
            
            const toggleMicBtn = document.getElementById('toggleMicBtn');
            if (toggleMicBtn && typeof window.CallManager !== 'undefined') {
                toggleMicBtn.addEventListener('click', function() {
                    window.CallManager.toggleMute();
                });
            }
            
            const toggleCameraBtn = document.getElementById('toggleCameraBtn');
            if (toggleCameraBtn && typeof window.CallManager !== 'undefined') {
                toggleCameraBtn.addEventListener('click', function() {
                    window.CallManager.toggleCamera();
                });
            }
            
            const switchCameraBtn = document.getElementById('switchCameraBtn');
            if (switchCameraBtn && typeof window.CallManager !== 'undefined') {
                switchCameraBtn.addEventListener('click', function() {
                    window.CallManager.switchCamera();
                });
            }
            
            const fullscreenBtn = document.getElementById('fullscreenBtn');
            if (fullscreenBtn) {
                fullscreenBtn.addEventListener('click', function() {
                    const modal = document.getElementById('videoCallModal');
                    if (modal) {
                        if (document.fullscreenElement) {
                            document.exitFullscreen();
                        } else {
                            modal.requestFullscreen();
                        }
                    }
                });
            }
        });
    </script>
    
    <!-- –°–∫—Ä—ã—Ç—ã–π input –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ -->
    <input type="file" 
           id="fileInput" 
           accept="image/*,video/*,.pdf,.doc,.docx,.txt" 
           multiple 
           style="display: none;">
    
    <!-- –≠–º–æ–¥–∑–∏-–ø–∏–∫–µ—Ä (—Å–∫—Ä—ã—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
    <div id="emojiPicker" class="emoji-picker">
        <div class="emoji-header">
            <div class="emoji-categories">
                <button class="emoji-category-btn active" data-category="smileys">üòÄ</button>
                <button class="emoji-category-btn" data-category="people">üëã</button>
                <button class="emoji-category-btn" data-category="animals">üê∂</button>
                <button class="emoji-category-btn" data-category="food">üçï</button>
                <button class="emoji-category-btn" data-category="activities">‚öΩ</button>
                <button class="emoji-category-btn" data-category="objects">üí°</button>
                <button class="emoji-category-btn" data-category="symbols">‚ù§Ô∏è</button>
                <button class="emoji-category-btn" data-category="flags">üéå</button>
            </div>
        </div>
        <div class="emoji-grid" id="emojiGrid">
            <!-- –≠–º–æ–¥–∑–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
        </div>
        <div class="emoji-search">
            <input type="text" id="emojiSearch" placeholder="–ü–æ–∏—Å–∫ —ç–º–æ–¥–∑–∏...">
        </div>
    </div>
</body>
</html>
