
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: #fff;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .test-section {
            background: #2d2d2d;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        h1 {
            color: #00ccff;
            margin-bottom: 30px;
            text-align: center;
        }
        
        h2 {
            color: #00ffaa;
            margin-bottom: 15px;
            border-bottom: 2px solid #00ccff;
            padding-bottom: 5px;
        }
        
        .test-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        button {
            background: #00ccff;
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        button:hover {
            background: #00ffaa;
            transform: translateY(-2px);
        }
        
        .results {
            background: #1a1a1a;
            padding: 15px;
            border-radius: 5px;
            margin-top: 10px;
            overflow-x: auto;
        }
        
        .user-card {
            background: #3d3d3d;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 5px;
            border-left: 4px solid #00ccff;
        }
        
        .user-card h4 {
            color: #00ffaa;
            margin-bottom: 5px;
        }
        
        .user-card p {
            color: #ccc;
            font-size: 14px;
            margin: 3px 0;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            color: #00ccff;
        }
        
        input, textarea {
            width: 100%;
            padding: 10px;
            background: #1a1a1a;
            border: 1px solid #444;
            border-radius: 5px;
            color: #fff;
            margin-bottom: 10px;
        }
        
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        
        .success {
            background: rgba(0, 255, 170, 0.2);
            color: #00ffaa;
            border: 1px solid #00ffaa;
        }
        
        .error {
            background: rgba(255, 107, 107, 0.2);
            color: #ff6b6b;
            border: 1px solid #ff6b6b;
        }
        
        .info {
            background: rgba(0, 204, 255, 0.2);
            color: #00ccff;
            border: 1px solid #00ccff;
        }
        
        .search-results {
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π TechTariff</h1>
        
        <!-- –°–µ–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ -->
        <div class="test-section">
            <h2>–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö</h2>
            <div class="test-buttons">
                <button onclick="initDemoData()">–°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</button>
                <button onclick="clearAllData()">–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ</button>
                <button onclick="checkData()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
            </div>
            <div id="initResults"></div>
        </div>
        
        <!-- –°–µ–∫—Ü–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
        <div class="test-section">
            <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>
            <div class="form-group">
                <label for="regName">–ò–º—è:</label>
                <input type="text" id="regName" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è">
                
                <label for="regEmail">Email:</label>
                <input type="email" id="regEmail" placeholder="–í–≤–µ–¥–∏—Ç–µ email">
                
                <label for="regPassword">–ü–∞—Ä–æ–ª—å:</label>
                <input type="password" id="regPassword" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
                
                <button onclick="registerUser()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å</button>
            </div>
            <div id="registerResults"></div>
        </div>
        
        <!-- –°–µ–∫—Ü–∏—è –≤—Ö–æ–¥–∞ -->
        <div class="test-section">
            <h2>–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h2>
            <div class="form-group">
                <label for="loginEmail">Email:</label>
                <input type="email" id="loginEmail" placeholder="–í–≤–µ–¥–∏—Ç–µ email">
                
                <label for="loginPassword">–ü–∞—Ä–æ–ª—å:</label>
                <input type="password" id="loginPassword" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
                
                <button onclick="loginUser()">–í–æ–π—Ç–∏</button>
                <button onclick="logoutUser()">–í—ã–π—Ç–∏</button>
            </div>
            <div id="loginResults"></div>
        </div>
        
        <!-- –°–µ–∫—Ü–∏—è –ø–æ–∏—Å–∫–∞ -->
        <div class="test-section">
            <h2>–ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h2>
            <div class="form-group">
                <input type="text" id="searchQuery" placeholder="–í–≤–µ–¥–∏—Ç–µ ID, –∏–º—è –∏–ª–∏ email" 
                       onkeyup="if(event.key === 'Enter') searchUsers()">
                <button onclick="searchUsers()">–ü–æ–∏—Å–∫</button>
            </div>
            <div id="searchResults" class="search-results"></div>
        </div>
        
        <!-- –°–µ–∫—Ü–∏—è –¥—Ä—É–∑–µ–π -->
        <div class="test-section">
            <h2>–°–∏—Å—Ç–µ–º–∞ –¥—Ä—É–∑–µ–π</h2>
            <div class="form-group">
                <label for="friendId">ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –∑–∞—è–≤–∫–∏:</label>
                <input type="text" id="friendId" placeholder="–í–≤–µ–¥–∏—Ç–µ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
                <button onclick="sendFriendRequest()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É –≤ –¥—Ä—É–∑—å—è</button>
            </div>
            
            <div class="test-buttons">
                <button onclick="showFriends()">–ü–æ–∫–∞–∑–∞—Ç—å –º–æ–∏—Ö –¥—Ä—É–∑–µ–π</button>
                <button onclick="showIncomingRequests()">–í—Ö–æ–¥—è—â–∏–µ –∑–∞—è–≤–∫–∏</button>
                <button onclick="showOutgoingRequests()">–ò—Å—Ö–æ–¥—è—â–∏–µ –∑–∞—è–≤–∫–∏</button>
            </div>
            
            <div id="friendsResults"></div>
        </div>
        
        <!-- –°–µ–∫—Ü–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ -->
        <div class="test-section">
            <h2>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ</h2>
            <div class="test-buttons">
                <button onclick="showAllUsers()">–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤ —Å–∏—Å—Ç–µ–º–µ</button>
                <button onclick="showCurrentUser()">–¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</button>
                <button onclick="showStorageInfo()">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ</button>
            </div>
            <div id="infoResults"></div>
        </div>
    </div>

    <script src="hashStorage.js"></script>
    <script>
        // –î–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –¥–ª—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –∫–Ω–æ–ø–æ–∫
        document.addEventListener('DOMContentLoaded', function() {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∫–Ω–æ–ø–æ–∫
            initButtonHandlers();
            
            checkData();
            
            // –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            document.getElementById('loginEmail').value = 'alex@example.com';
            document.getElementById('loginPassword').value = 'password123';
            
            document.getElementById('searchQuery').value = 'user';
            
            document.getElementById('friendId').value = 'user_003';
        });
        
        function initButtonHandlers() {
            // –ö–Ω–æ–ø–∫–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
            const initDemoBtn = document.querySelector('button[onclick="initDemoData()"]');
            if (initDemoBtn) initDemoBtn.addEventListener('click', initDemoData);
            
            const clearAllBtn = document.querySelector('button[onclick="clearAllData()"]');
            if (clearAllBtn) clearAllBtn.addEventListener('click', clearAllData);
            
            const checkDataBtn = document.querySelector('button[onclick="checkData()"]');
            if (checkDataBtn) checkDataBtn.addEventListener('click', checkData);
            
            // –ö–Ω–æ–ø–∫–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
            const registerBtn = document.querySelector('button[onclick="registerUser()"]');
            if (registerBtn) registerBtn.addEventListener('click', registerUser);
            
            // –ö–Ω–æ–ø–∫–∏ –≤—Ö–æ–¥–∞/–≤—ã—Ö–æ–¥–∞
            const loginBtn = document.querySelector('button[onclick="loginUser()"]');
            if (loginBtn) loginBtn.addEventListener('click', loginUser);
            
            const logoutBtn = document.querySelector('button[onclick="logoutUser()"]');
            if (logoutBtn) logoutBtn.addEventListener('click', logoutUser);
            
            // –ü–æ–∏—Å–∫
            const searchBtn = document.querySelector('button[onclick="searchUsers()"]');
            if (searchBtn) searchBtn.addEventListener('click', searchUsers);
            
            const searchInput = document.getElementById('searchQuery');
            if (searchInput) {
                searchInput.addEventListener('keyup', function(e) {
                    if (e.key === 'Enter') searchUsers();
                });
            }
            
            // –î—Ä—É–∑—å—è
            const friendRequestBtn = document.querySelector('button[onclick="sendFriendRequest()"]');
            if (friendRequestBtn) friendRequestBtn.addEventListener('click', sendFriendRequest);
            
            const showFriendsBtn = document.querySelector('button[onclick="showFriends()"]');
            if (showFriendsBtn) showFriendsBtn.addEventListener('click', showFriends);
            
            const showIncomingBtn = document.querySelector('button[onclick="showIncomingRequests()"]');
            if (showIncomingBtn) showIncomingBtn.addEventListener('click', showIncomingRequests);
            
            const showOutgoingBtn = document.querySelector('button[onclick="showOutgoingRequests()"]');
            if (showOutgoingBtn) showOutgoingBtn.addEventListener('click', showOutgoingRequests);
            
            // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
            const showAllUsersBtn = document.querySelector('button[onclick="showAllUsers()"]');
            if (showAllUsersBtn) showAllUsersBtn.addEventListener('click', showAllUsers);
            
            const showCurrentBtn = document.querySelector('button[onclick="showCurrentUser()"]');
            if (showCurrentBtn) showCurrentBtn.addEventListener('click', showCurrentUser);
            
            const showStorageBtn = document.querySelector('button[onclick="showStorageInfo()"]');
            if (showStorageBtn) showStorageBtn.addEventListener('click', showStorageInfo);
        }
        
        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–µ–º–æ-–¥–∞–Ω–Ω—ã—Ö
        async function initDemoData() {
            try {
                // –û—á–∏—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                document.getElementById('initResults').innerHTML = '<div class="status info">–°–æ–∑–¥–∞—é —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ...</div>';
                
                // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                const demoUsers = [
                    {
                        id: 'user_001',
                        name: '–ê–ª–µ–∫—Å–∞–Ω–¥—Ä –ò–≤–∞–Ω–æ–≤',
                        email: 'alex@example.com',
                        passwordHash: await HashStorage.hashPassword('password123'),
                        createdAt: new Date().toISOString(),
                        lastLogin: new Date().toISOString(),
                        tariff: 'pro',
                        avatarColor: '#00ccff'
                    },
                    {
                        id: 'user_002',
                        name: '–ú–∞—Ä–∏—è –ü–µ—Ç—Ä–æ–≤–∞',
                        email: 'maria@example.com',
                        passwordHash: await HashStorage.hashPassword('password123'),
                        createdAt: new Date().toISOString(),
                        lastLogin: new Date().toISOString(),
                        tariff: 'basic',
                        avatarColor: '#ff6b6b'
                    },
                    {
                        id: 'user_003',
                        name: '–î–º–∏—Ç—Ä–∏–π –°–∏–¥–æ—Ä–æ–≤',
                        email: 'dmitry@example.com',
                        passwordHash: await HashStorage.hashPassword('password123'),
                        createdAt: new Date().toISOString(),
                        lastLogin: new Date().toISOString(),
                        tariff: 'free',
                        avatarColor: '#00ffaa'
                    },
                    {
                        id: 'admin_001',
                        name: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä',
                        email: 'admin@techtariff.com',
                        passwordHash: await HashStorage.hashPassword('admin123'),
                        createdAt: new Date().toISOString(),
                        lastLogin: new Date().toISOString(),
                        tariff: 'pro',
                        role: 'admin',
                        avatarColor: '#ff4757'
                    }
                ];
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                localStorage.setItem('users', JSON.stringify(demoUsers));
                
                // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –∑–∞—è–≤–∫–∏ –≤ –¥—Ä—É–∑—å—è
                const friendships = [
                    {
                        id: 'req_001_002',
                        userId1: 'user_001',
                        userId2: 'user_002',
                        senderId: 'user_001',
                        receiverId: 'user_002',
                        status: 'accepted',
                        message: '–ü—Ä–∏–≤–µ—Ç! –î–∞–≤–∞–π –¥—Ä—É–∂–∏—Ç—å!',
                        createdAt: new Date(Date.now() - 86400000).toISOString(),
                        senderName: '–ê–ª–µ–∫—Å–∞–Ω–¥—Ä –ò–≤–∞–Ω–æ–≤',
                        receiverName: '–ú–∞—Ä–∏—è –ü–µ—Ç—Ä–æ–≤–∞'
                    },
                    {
                        id: 'req_001_003',
                        userId1: 'user_001',
                        userId2: 'user_003',
                        senderId: 'user_003',
                        receiverId: 'user_001',
                        status: 'pending',
                        message: '–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ!',
                        createdAt: new Date(Date.now() - 3600000).toISOString(),
                        senderName: '–î–º–∏—Ç—Ä–∏–π –°–∏–¥–æ—Ä–æ–≤',
                        receiverName: '–ê–ª–µ–∫—Å–∞–Ω–¥—Ä –ò–≤–∞–Ω–æ–≤'
                    }
                ];
                
                localStorage.setItem('friendships', JSON.stringify(friendships));
                
                // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ —á–∞—Ç—ã
                const chats = [
                    {
                        id: 'chat_001',
                        type: 'private',
                        name: '–ú–∞—Ä–∏—è –ü–µ—Ç—Ä–æ–≤–∞',
                        avatarColor: '#ff6b6b',
                        participants: ['user_001', 'user_002'],
                        createdAt: new Date(Date.now() - 86400000).toISOString(),
                        messages: [
                            {
                                id: 'msg_001',
                                chatId: 'chat_001',
                                senderId: 'user_001',
                                senderName: '–ê–ª–µ–∫—Å–∞–Ω–¥—Ä –ò–≤–∞–Ω–æ–≤',
                                senderAvatar: '#00ccff',
                                content: '–ü—Ä–∏–≤–µ—Ç, –ú–∞—Ä–∏—è! –ö–∞–∫ –¥–µ–ª–∞?',
                                createdAt: new Date(Date.now() - 7200000).toISOString(),
                                isRead: true
                            },
                            {
                                id: 'msg_002',
                                chatId: 'chat_001',
                                senderId: 'user_002',
                                senderName: '–ú–∞—Ä–∏—è –ü–µ—Ç—Ä–æ–≤–∞',
                                senderAvatar: '#ff6b6b',
                                content: '–ü—Ä–∏–≤–µ—Ç! –í—Å—ë –æ—Ç–ª–∏—á–Ω–æ, —Å–ø–∞—Å–∏–±–æ! –ê —É —Ç–µ–±—è?',
                                createdAt: new Date(Date.now() - 7000000).toISOString(),
                                isRead: true
                            }
                        ]
                    }
                ];
                
                localStorage.setItem('chats', JSON.stringify(chats));
                
                document.getElementById('initResults').innerHTML = 
                    '<div class="status success">‚úÖ –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω—ã!<br>' +
                    '‚Ä¢ 4 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–≤–∫–ª—é—á–∞—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞)<br>' +
                    '‚Ä¢ 2 –∑–∞—è–≤–∫–∏ –≤ –¥—Ä—É–∑—å—è<br>' +
                    '‚Ä¢ 1 —á–∞—Ç —Å —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏</div>';
                    
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                showAllUsers();
                
            } catch (error) {
                document.getElementById('initResults').innerHTML = 
                    '<div class="status error">‚ùå –û—à–∏–±–∫–∞: ' + error.message + '</div>';
            }
        }
        
        // –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
        function clearAllData() {
            localStorage.clear();
            document.getElementById('initResults').innerHTML = 
                '<div class="status success">‚úÖ –í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã!</div>';
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        function checkData() {
            const users = localStorage.getItem('users');
            const friendships = localStorage.getItem('friendships');
            const chats = localStorage.getItem('chats');
            
            let result = '<div class="status info">üìä –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞:</div><div class="results">';
            
            if (users) {
                const usersCount = JSON.parse(users).length;
                result += `<p>üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ${usersCount}</p>`;
            } else {
                result += '<p>üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: –Ω–µ—Ç</p>';
            }
            
            if (friendships) {
                const friendshipsCount = JSON.parse(friendships).length;
                result += `<p>ü§ù –ó–∞—è–≤–æ–∫ –≤ –¥—Ä—É–∑—å—è: ${friendshipsCount}</p>`;
            } else {
                result += '<p>ü§ù –ó–∞—è–≤–æ–∫ –≤ –¥—Ä—É–∑—å—è: –Ω–µ—Ç</p>';
            }
            
            if (chats) {
                const chatsCount = JSON.parse(chats).length;
                result += `<p>üí¨ –ß–∞—Ç–æ–≤: ${chatsCount}</p>`;
            } else {
                result += '<p>üí¨ –ß–∞—Ç–æ–≤: –Ω–µ—Ç</p>';
            }
            
            const currentUser = HashStorage.getCurrentUser();
            if (currentUser) {
                result += `<p>üë§ –¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${currentUser.name} (${currentUser.email})</p>`;
            } else {
                result += '<p>üë§ –¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω</p>';
            }
            
            result += '</div>';
            document.getElementById('initResults').innerHTML = result;
        }
        
        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function registerUser() {
            const name = document.getElementById('regName').value;
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            
            if (!name || !email || !password) {
                document.getElementById('registerResults').innerHTML = 
                    '<div class="status error">‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è</div>';
                return;
            }
            
            const result = await HashStorage.saveUser({ name, email, password });
            
            if (result.success) {
                document.getElementById('registerResults').innerHTML = 
                    `<div class="status success">‚úÖ ${result.message}<br>ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${result.user.id}</div>`;
                
                // –û—á–∏—â–∞–µ–º –ø–æ–ª—è
                document.getElementById('regName').value = '';
                document.getElementById('regEmail').value = '';
                document.getElementById('regPassword').value = '';
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                showAllUsers();
            } else {
                document.getElementById('registerResults').innerHTML = 
                    `<div class="status error">‚ùå ${result.message}</div>`;
            }
        }
        
        // –í—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function loginUser() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                document.getElementById('loginResults').innerHTML = 
                    '<div class="status error">‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è</div>';
                return;
            }
            
            const result = await HashStorage.authenticate(email, password);
            
            if (result.success) {
                document.getElementById('loginResults').innerHTML = 
                    `<div class="status success">‚úÖ –í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!<br>` +
                    `–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${result.user.name}!</div>`;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                showCurrentUser();
            } else {
                document.getElementById('loginResults').innerHTML = 
                    `<div class="status error">‚ùå ${result.message}</div>`;
            }
        }
        
        // –í—ã—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function logoutUser() {
            HashStorage.logout();
            document.getElementById('loginResults').innerHTML = 
                '<div class="status success">‚úÖ –í—ã –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã</div>';
            document.getElementById('loginEmail').value = '';
            document.getElementById('loginPassword').value = '';
        }
        
        // –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        function searchUsers() {
            const query = document.getElementById('searchQuery').value;
            
            if (!query || query.trim().length < 2) {
                document.getElementById('searchResults').innerHTML = 
                    '<div class="status info">‚ÑπÔ∏è –í–≤–µ–¥–∏—Ç–µ —Ö–æ—Ç—è –±—ã 2 —Å–∏–º–≤–æ–ª–∞</div>';
                return;
            }
            
            const currentUser = HashStorage.getCurrentUser();
            const results = HashStorage.searchUsers(query, true);
            
            if (results.length === 0) {
                document.getElementById('searchResults').innerHTML = 
                    '<div class="status info">‚ÑπÔ∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
                return;
            }
            
            let html = `<div class="status info">üîç –ù–∞–π–¥–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ${results.length}</div>`;
            
            results.forEach(user => {
                const friendshipStatus = HashStorage.getFriendshipStatus(currentUser?.id, user.id);
                let statusText = '';
                
                switch(friendshipStatus) {
                    case 'accepted':
                        statusText = '<span style="color:#00ffaa">‚úì –î—Ä—É–≥</span>';
                        break;
                    case 'pending':
                        statusText = '<span style="color:#ffa502">‚è≥ –ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞</span>';
                        break;
                    default:
                        statusText = '<span style="color:#00ccff">–ù–µ –≤ –¥—Ä—É–∑—å—è—Ö</span>';
                }
                
                html += `
                    <div class="user-card">
                        <h4>${user.name}</h4>
                        <p>üìß ${user.email}</p>
                        <p>üÜî ${user.id}</p>
                        <p>${statusText}</p>
                        <p><small>–¢–∞—Ä–∏—Ñ: ${user.tariff}</small></p>
                        ${currentUser && friendshipStatus === 'none' ? 
                            `<button onclick="sendRequestTo('${user.id}')" style="font-size:12px; padding:5px 10px;">
                                –î–æ–±–∞–≤–∏—Ç—å –≤ –¥—Ä—É–∑—å—è
                            </button>` : ''}
                    </div>
                `;
            });
            
            document.getElementById('searchResults').innerHTML = html;
        }
        
        // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
        function sendRequestTo(userId) {
            const currentUser = HashStorage.getCurrentUser();
            
            if (!currentUser) {
                alert('–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É');
                return;
            }
            
            const result = HashStorage.sendFriendRequest(currentUser.id, userId, '–ü—Ä–∏–≤–µ—Ç! –î–∞–≤–∞–π –¥—Ä—É–∂–∏—Ç—å!');
            
            if (result.success) {
                alert('–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!');
                searchUsers(); // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞
            } else {
                alert('–û—à–∏–±–∫–∞: ' + result.message);
            }
        }
        
        // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É –≤ –¥—Ä—É–∑—å—è
        function sendFriendRequest() {
            const friendId = document.getElementById('friendId').value;
            
            if (!friendId) {
                alert('–í–≤–µ–¥–∏—Ç–µ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
                return;
            }
            
            const currentUser = HashStorage.getCurrentUser();
            
            if (!currentUser) {
                alert('–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É');
                return;
            }
            
            const result = HashStorage.sendFriendRequest(currentUser.id, friendId, '–ü—Ä–∏–≤–µ—Ç! –î–∞–≤–∞–π –¥—Ä—É–∂–∏—Ç—å!');
            
            if (result.success) {
                alert('–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞! ID –∑–∞—è–≤–∫–∏: ' + result.request.id);
                document.getElementById('friendId').value = '';
                showOutgoingRequests();
            } else {
                alert('–û—à–∏–±–∫–∞: ' + result.message);
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –¥—Ä—É–∑–µ–π
        function showFriends() {
            const currentUser = HashStorage.getCurrentUser();
            
            if (!currentUser) {
                document.getElementById('friendsResults').innerHTML = 
                    '<div class="status error">‚ùå –°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É</div>';
                return;
            }
            
            const friends = HashStorage.getFriends(currentUser.id);
            
            if (friends.length === 0) {
                document.getElementById('friendsResults').innerHTML = 
                    '<div class="status info">‚ÑπÔ∏è –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –¥—Ä—É–∑–µ–π</div>';
                return;
            }
            
            let html = `<div class="status success">üë• –í–∞—à–∏ –¥—Ä—É–∑—å—è (${friends.length}):</div>`;
            
            friends.forEach(friend => {
                html += `
                    <div class="user-card">
                        <h4>${friend.friend_name}</h4>
                        <p>üìß ${friend.email}</p>
                        <p>üÜî ${friend.friend_id}</p>
                        <p><small>–î—Ä—É–∂–∞—Ç —Å: ${new Date(friend.friends_since).toLocaleDateString()}</small></p>
                        <button onclick="startChat('${friend.friend_id}')" style="font-size:12px; padding:5px 10px;">
                            üí¨ –ù–∞—á–∞—Ç—å —á–∞—Ç
                        </button>
                    </div>
                `;
            });
            
            document.getElementById('friendsResults').innerHTML = html;
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –≤—Ö–æ–¥—è—â–∏–µ –∑–∞—è–≤–∫–∏
        function showIncomingRequests() {
            const currentUser = HashStorage.getCurrentUser();
            
            if (!currentUser) {
                document.getElementById('friendsResults').innerHTML = 
                    '<div class="status error">‚ùå –°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É</div>';
                return;
            }
            
            const requests = HashStorage.getFriendRequests(currentUser.id, 'incoming');
            
            if (requests.length === 0) {
                document.getElementById('friendsResults').innerHTML = 
                    '<div class="status info">‚ÑπÔ∏è –ù–µ—Ç –≤—Ö–æ–¥—è—â–∏—Ö –∑–∞—è–≤–æ–∫</div>';
                return;
            }
            
            let html = `<div class="status info">üì• –í—Ö–æ–¥—è—â–∏–µ –∑–∞—è–≤–∫–∏ (${requests.length}):</div>`;
            
            requests.forEach(request => {
                html += `
                    <div class="user-card">
                        <h4>${request.sender_name}</h4>
                        <p>${request.message || '–•–æ—á–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –≤–∞—Å –≤ –¥—Ä—É–∑—å—è'}</p>
                        <p><small>–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: ${new Date(request.created_at).toLocaleDateString()}</small></p>
                        <div style="display:flex;gap:10px;margin-top:10px;">
                            <button onclick="respondToRequest('${request.id}', 'accepted')" 
                                    style="font-size:12px; padding:5px 10px; background:#00ffaa;">
                                ‚úÖ –ü—Ä–∏–Ω—è—Ç—å
                            </button>
                            <button onclick="respondToRequest('${request.id}', 'rejected')" 
                                    style="font-size:12px; padding:5px 10px; background:#ff6b6b;">
                                ‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å
                            </button>
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('friendsResults').innerHTML = html;
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –∏—Å—Ö–æ–¥—è—â–∏–µ –∑–∞—è–≤–∫–∏
        function showOutgoingRequests() {
            const currentUser = HashStorage.getCurrentUser();
            
            if (!currentUser) {
                document.getElementById('friendsResults').innerHTML = 
                    '<div class="status error">‚ùå –°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É</div>';
                return;
            }
            
            const requests = HashStorage.getFriendRequests(currentUser.id, 'outgoing');
            
            if (requests.length === 0) {
                document.getElementById('friendsResults').innerHTML = 
                    '<div class="status info">‚ÑπÔ∏è –ù–µ—Ç –∏—Å—Ö–æ–¥—è—â–∏—Ö –∑–∞—è–≤–æ–∫</div>';
                return;
            }
            
            let html = `<div class="status info">üì§ –ò—Å—Ö–æ–¥—è—â–∏–µ –∑–∞—è–≤–∫–∏ (${requests.length}):</div>`;
            
            requests.forEach(request => {
                html += `
                    <div class="user-card">
                        <h4>${request.receiver_name}</h4>
                        <p>${request.message || '–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞'}</p>
                        <p><small>–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: ${new Date(request.created_at).toLocaleDateString()}</small></p>
                        <button onclick="cancelRequest('${request.id}')" 
                                style="font-size:12px; padding:5px 10px; background:#ff6b6b;">
                            ‚ùå –û—Ç–º–µ–Ω–∏—Ç—å –∑–∞—è–≤–∫—É
                        </button>
                    </div>
                `;
            });
            
            document.getElementById('friendsResults').innerHTML = html;
        }
        
        // –û—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –∑–∞—è–≤–∫—É
        function respondToRequest(requestId, response) {
            const currentUser = HashStorage.getCurrentUser();
            
            if (!currentUser) {
                alert('–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É');
                return;
            }
            
            const result = HashStorage.respondToFriendRequest(requestId, currentUser.id, response);
            
            if (result.success) {
                alert(response === 'accepted' ? '–ó–∞—è–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞!' : '–ó–∞—è–≤–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞');
                showIncomingRequests();
                showFriends();
            } else {
                alert('–û—à–∏–±–∫–∞: ' + result.message);
            }
        }
        
        // –û—Ç–º–µ–Ω–∏—Ç—å –∑–∞—è–≤–∫—É
        function cancelRequest(requestId) {
            respondToRequest(requestId, 'rejected');
        }
        
        // –ù–∞—á–∞—Ç—å —á–∞—Ç (–∑–∞–≥–ª—É—à–∫–∞)
        function startChat(friendId) {
            alert(`–ß–∞—Ç —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º ${friendId} –±—É–¥–µ—Ç –æ—Ç–∫—Ä—ã—Ç –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ`);
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        function showAllUsers() {
            const usersStr = localStorage.getItem('users');
            
            if (!usersStr) {
                document.getElementById('infoResults').innerHTML = 
                    '<div class="status info">‚ÑπÔ∏è –ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —Å–∏—Å—Ç–µ–º–µ</div>';
                return;
            }
            
            const users = JSON.parse(usersStr);
            
            let html = `<div class="status info">üë• –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (${users.length}):</div>`;
            
            users.forEach(user => {
                html += `
                    <div class="user-card">
                        <h4>${user.name} ${user.role === 'admin' ? 'üëë' : ''}</h4>
                        <p>üìß ${user.email}</p>
                        <p>üÜî ${user.id}</p>
                        <p>üé® –¶–≤–µ—Ç: <span style="color:${user.avatarColor}">${user.avatarColor}</span></p>
                        <p><small>–¢–∞—Ä–∏—Ñ: ${user.tariff} | –°–æ–∑–¥–∞–Ω: ${new Date(user.createdAt).toLocaleDateString()}</small></p>
                    </div>
                `;
            });
            
            document.getElementById('infoResults').innerHTML = html;
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function showCurrentUser() {
            const user = HashStorage.getCurrentUser();
            
            if (!user) {
                document.getElementById('infoResults').innerHTML = 
                    '<div class="status info">‚ÑπÔ∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω</div>';
                return;
            }
            
            let html = `<div class="status success">üë§ –¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</div>
                <div class="user-card">
                    <h4>${user.name} ${user.role === 'admin' ? 'üëë' : ''}</h4>
                    <p>üìß ${user.email}</p>
                    <p>üÜî ${user.id}</p>
                    <p>üé® –¶–≤–µ—Ç: <span style="color:${user.avatarColor}">${user.avatarColor}</span></p>
                    <p>üìä –¢–∞—Ä–∏—Ñ: ${user.tariff}</p>
                    <p><small>–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω: ${new Date(user.createdAt).toLocaleDateString()}</small></p>
                    <p><small>–ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—Ö–æ–¥: ${new Date(user.lastLogin).toLocaleString()}</small></p>
                    ${user.activity && user.activity.length > 0 ? 
                        `<p><small>–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π: ${user.activity.length}</small></p>` : ''}
                </div>`;
            
            document.getElementById('infoResults').innerHTML = html;
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
        function showStorageInfo() {
            let totalSize = 0;
            let items = [];
            
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                const value = localStorage.getItem(key);
                const size = new Blob([value]).size;
                totalSize += size;
                
                let itemInfo = {
                    key: key,
                    size: size,
                    valueLength: value.length
                };
                
                try {
                    const parsed = JSON.parse(value);
                    if (Array.isArray(parsed)) {
                        itemInfo.type = 'array';
                        itemInfo.count = parsed.length;
                    } else if (typeof parsed === 'object') {
                        itemInfo.type = 'object';
                    } else {
                        itemInfo.type = 'string';
                    }
                } catch {
                    itemInfo.type = 'string';
                }
                
                items.push(itemInfo);
            }
            
            let html = `<div class="status info">üíæ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ:</div>
                <div class="results">
                    <p>üìÅ –í—Å–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤: ${localStorage.length}</p>
                    <p>üíø –û–±—â–∏–π —Ä–∞–∑–º–µ—Ä: ${(totalSize / 1024).toFixed(2)} KB</p>
                    <hr>`;
            
            items.sort((a, b) => b.size - a.size).forEach(item => {
                html += `<p><strong>${item.key}:</strong> ${(item.size / 1024).toFixed(2)} KB`;
                
                if (item.type === 'array') {
                    html += ` (–º–∞—Å—Å–∏–≤, ${item.count} —ç–ª–µ–º–µ–Ω—Ç–æ–≤)`;
                } else if (item.type === 'object') {
                    html += ` (–æ–±—ä–µ–∫—Ç)`;
                }
                
                html += `</p>`;
            });
            
            html += '</div>';
            document.getElementById('infoResults').innerHTML = html;
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            checkData();
            
            // –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            document.getElementById('loginEmail').value = 'alex@example.com';
            document.getElementById('loginPassword').value = 'password123';
            
            document.getElementById('searchQuery').value = 'user';
            
            document.getElementById('friendId').value = 'user_003';
        });
    </script>
</body>
</html>
